<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Order</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f8f9fa;
        }
        .form-container {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <!-- Display flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 1055;">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="form-container col-md-4">
        <h1 class="text-center mb-4">Place Your Order</h1>
        <form action="{{ url_for('customer_routes.place_order_route') }}" method="POST" id="orderForm">
            <div class="mb-3">
                <label for="customerId" class="form-label">Customer ID</label>
                <input type="text" id="customerId" name="customerId" class="form-control" required>
            </div>
            <div class="mb-3">
                <label for="location" class="form-label">Delivery Location</label>
                <input type="text" id="location" name="location" class="form-control">
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="useCurrentLocation" name="useCurrentLocation">
                <label class="form-check-label" for="useCurrentLocation">
                    Use my current location
                </label>
            </div>
            <button type="submit" class="btn btn-primary w-100">Place Order</button>
        </form>
    </div>

    <!-- Bootstrap JS (for pop-up alerts) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Geolocation & Reverse Geocoding Script -->
    <script>
        const useCurrentLocationCheckbox = document.getElementById('useCurrentLocation');
        const locationInput = document.getElementById('location');
        const HERE_API_KEY = 'y24ahK7VnVrMkaDdBKCQVKKsNi2P8zTp3E-IHzmyfrQ';  // Replace with your HERE API key

        useCurrentLocationCheckbox.addEventListener('change', function () {
            if (this.checked) {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // Reverse geocoding to get the address
                        const reverseGeocodeUrl = `https://revgeocode.search.hereapi.com/v1/revgeocode?at=${lat},${lng}&apiKey=${HERE_API_KEY}`;

                        fetch(reverseGeocodeUrl)
                            .then(response => response.json())
                            .then(data => {
                                if (data && data.items && data.items.length > 0) {
                                    const address = data.items[0].address.label;
                                    locationInput.value = address;  // Set the address in the input field
                                } else {
                                    locationInput.value = 'Address not found';
                                }
                            })
                            .catch(error => {
                                console.error('Error during reverse geocoding:', error);
                                locationInput.value = 'Error getting address';
                            });
                    });
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            } else {
                locationInput.value = '';
            }
        });
    </script>
    
</body>
</html>
